<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>lic-blog</title>
  <meta name="author" content="triumphLic">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="lic-blog"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="lic-blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/">lic-blog</a></h1>
  <h2><a href="/"></a></h2>
  <nav id="main-nav">
    <ul>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/11/18/js-base-7/">手写promise</a></h1>
  

      
        <time datetime="2020-11-18T09:16:05.000Z">2020-11-18</time>
      
    </header>
    <div class="entry">
      
        <h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>默写完去看看对不对</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PENDING = <span class="string">'pending'</span></span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">'rejected'</span></span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">'fulfilled'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LPromise</span> </span>&#123;</span><br><span class="line">  status = PENDING</span><br><span class="line">  value = <span class="literal">null</span></span><br><span class="line">  reason = <span class="literal">null</span></span><br><span class="line">  resolveCallBacks = []</span><br><span class="line">  rejectCallBacks = []</span><br><span class="line">  <span class="keyword">constructor</span>(handler) &#123;</span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value</span><br><span class="line">        <span class="keyword">this</span>.status = FULFILLED</span><br><span class="line">        <span class="keyword">this</span>.resolveCallBacks.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> reject = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">        <span class="keyword">this</span>.reason = reason</span><br><span class="line">        <span class="keyword">this</span>.status = REJECTED</span><br><span class="line">        <span class="keyword">this</span>.rejectCallBacks.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      handler(resolve, reject)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">      reject(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  then(onFulFilled, onRejected)&#123;</span><br><span class="line"></span><br><span class="line">    onFulFilled = onFulFilled <span class="keyword">instanceof</span> <span class="built_in">Function</span> ? onFulFilled : <span class="function"><span class="params">v</span> =&gt;</span> v</span><br><span class="line">    onRejected = onRejected <span class="keyword">instanceof</span> <span class="built_in">Function</span> ? onRejected : <span class="function"><span class="params">v</span> =&gt;</span> v</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> _promise = <span class="keyword">new</span> LPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.status === FULFILLED) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> v = onFulFilled(<span class="keyword">this</span>.value)</span><br><span class="line">            resolvePromise(_promise, v, resolve, reject)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.status === REJECTED) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> v = onRejected(<span class="keyword">this</span>.value)</span><br><span class="line">            resolvePromise(_promise, v, resolve, reject)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">        <span class="keyword">this</span>.resolveCallBacks.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">let</span> v = onFulFilled(<span class="keyword">this</span>.value)</span><br><span class="line">              resolvePromise(_promise, v, resolve, reject)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">              reject(e)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">this</span>.rejectCallBacks.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">let</span> v = onRejected(<span class="keyword">this</span>.value)</span><br><span class="line">              resolvePromise(_promise, v, resolve, reject)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">              reject(e)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> _promise</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>, onRejected)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">_promise, valFn, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (_promise === valFn) &#123;</span><br><span class="line">    reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'循环调用了'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((<span class="keyword">typeof</span> valFn === <span class="string">'object'</span> &amp;&amp; valFn !== <span class="literal">null</span>) || <span class="keyword">typeof</span> valFn === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> called = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> then = valFn.then</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">        then.call(valFn, v =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">          called = <span class="literal">true</span></span><br><span class="line">          resolvePromise(_promise, v, resolve, reject)</span><br><span class="line">        &#125;, e =&gt; &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve(valFn)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">      reject(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    resolve(valFn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> LPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'6666'</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">pro.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'the value is : '</span>, data)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'the value is : '</span> + data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'2the value is : '</span>, data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>还行，就是直接在md里写有单词拼错了</p>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/10/28/browser-3/">WebWorkers</a></h1>
  

      
        <time datetime="2020-10-28T08:50:02.000Z">2020-10-28</time>
      
    </header>
    <div class="entry">
      
        
      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/10/22/js-base-6/">手写Promise.all-limit</a></h1>
  

      
        <time datetime="2020-10-22T08:52:51.000Z">2020-10-22</time>
      
    </header>
    <div class="entry">
      
        <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DealPromise</span> </span>&#123;</span><br><span class="line">  list = [] <span class="comment">// 函数数组，每个函数调用返回一个真正需要执行的promise</span></span><br><span class="line">  limit = <span class="number">0</span> <span class="comment">// 限制请求个数</span></span><br><span class="line">  count = <span class="number">0</span> <span class="comment">// 当前正在请求的个数</span></span><br><span class="line">  holdList= []</span><br><span class="line">  <span class="keyword">constructor</span>(list, limit) &#123;</span><br><span class="line">    <span class="keyword">this</span>.limit = limit</span><br><span class="line">    <span class="keyword">this</span>.list = list</span><br><span class="line">  &#125;</span><br><span class="line">  map(fn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.count &lt; <span class="keyword">this</span>.limit) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.run(fn)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.hold(fn)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  run(fn) &#123;</span><br><span class="line">    <span class="keyword">return</span> fn().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.count--</span><br><span class="line">      <span class="keyword">this</span>.pickNext()</span><br><span class="line">      <span class="keyword">return</span> data</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  hold(fn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.holdList.push(&#123; fn, resolve, reject &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  pickNext() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.count &lt; <span class="keyword">this</span>.limit &amp;&amp; <span class="keyword">this</span>.holdList.length) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; fn, resolve, reject &#125; = <span class="keyword">this</span>.holdList.shift()</span><br><span class="line">      <span class="keyword">this</span>.run(fn).then(resolve).catch(reject)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseAllLimit</span>(<span class="params">list, limit</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> tool = <span class="keyword">new</span> DealPromise(list, limit)</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(list.map(<span class="function"><span class="params">fn</span> =&gt;</span> tool.map(fn)))</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简版</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">holdList</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (count &lt; limit &amp;&amp; holdList.length) &#123;</span><br><span class="line">    count++</span><br><span class="line">    <span class="keyword">const</span> &#123; fn, resolve, reject &#125; = holdList.shift</span><br><span class="line">    fn().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      count--</span><br><span class="line">      run()</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;).then(resolve).catch(reject)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseAllLimit</span>(<span class="params">list, limit</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> holdList = []</span><br><span class="line">  list = list.map(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(resolve, reject) =&gt; &#123;</span><br><span class="line">    holdList.push(&#123; fn, resolve, reject &#125;)</span><br><span class="line">    run(holdList)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(list)</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="async-await-实现"><a href="#async-await-实现" class="headerlink" title="async await 实现"></a>async await 实现</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseAllLimit</span>(<span class="params">list, limit</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> holdList = []</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (count &gt; limit) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        holdList.push(resolve)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    count++</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> fn()</span><br><span class="line">    count--</span><br><span class="line">    <span class="keyword">if</span> (holdList.length &gt; <span class="number">0</span>) holdList.shift()()</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(list.map(<span class="function"><span class="params">fn</span> =&gt;</span> run(fn)))</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>主要还是得需要执行的promise函数用一个函数包裹起来() =&gt; Promise 这样保证需要并发执行的promise不会在建立的时候就被动被执行了</p>
</li>
<li><p>其次就是缓存每个Promise的resolve和reject函数，这样整体的Promise.all就是在同步执行100个Promise，只是limit之外的Promise的状态一直是pending，直到它可以被执行，然后内部Promise再改变状态</p>
</li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/10/21/browser-2/">http</a></h1>
  

      
        <time datetime="2020-10-21T08:49:12.000Z">2020-10-21</time>
      
    </header>
    <div class="entry">
      
        <h2 id="HTTP历史版本"><a href="#HTTP历史版本" class="headerlink" title="HTTP历史版本"></a>HTTP历史版本</h2><ul>
<li>http1.0</li>
<li>http1.1</li>
<li>https</li>
<li>http2.0</li>
<li>http3.0</li>
</ul>
<h2 id="HttP1-0"><a href="#HttP1-0" class="headerlink" title="HttP1.0"></a>HttP1.0</h2><p>http1.0其实为了客户端获取html，js文件诞生的</p>
<ul>
<li>每次请求都会发生一遍TCP三次握手</li>
<li>没有长链接的解决发难</li>
<li>缓存由expires字段控制，不合理</li>
</ul>
<h2 id="HTTP1-1"><a href="#HTTP1-1" class="headerlink" title="HTTP1.1"></a>HTTP1.1</h2><p>http1.1在http1.0发布后六个月就诞生了，是现在应用最广的http规范</p>
<p>相对与http1.0，它增加了：</p>
<ul>
<li>keep-alive复用TCP通道，chrome好像限制每个进程只能开启5-6个tcp链接</li>
<li>cache-control字段控制浏览器缓存机制</li>
<li>增加HOST请求头，方便浏览器知道客户端ip地址</li>
</ul>
<h2 id="HTTP2-0"><a href="#HTTP2-0" class="headerlink" title="HTTP2.0"></a>HTTP2.0</h2><p>说到http2.0总会提起一个名词： 多路复用</p>
<p>多路复用：通俗的，它就是多个http请求使用同一个TCP链接通道进行数据传输</p>
<p>相对与之前的http版本，它实现了：</p>
<ul>
<li>多路复用</li>
<li>header压缩，其实很有必要，现在的http1.1优化方案都会对body内容进行gzip压缩处理，导致header的内容比较大，对头部信息进行压缩处理是必要的。通过服务端维护的字典项，某个字符标示“cache-control: no-cache”，差不多这样的形式。</li>
<li>二进制传输，http和tcp层增加了二进制传输层，用来压缩文本内容变成二进制数据，相同题集的二进制比文本的数据内容大太多了</li>
<li>分块传输，每个请求的id和index不同，确保了TCP通道上某个延时的http请求不会阻塞其他请求的不阻塞</li>
<li>支持服务器推送消息，毕竟通道一直开着</li>
</ul>
<h2 id="HTTP3-0"><a href="#HTTP3-0" class="headerlink" title="HTTP3.0"></a>HTTP3.0</h2><p>之前的http请求协议都是基于TCP/TCL的</p>
<p>TCP有一些缺点</p>
<ul>
<li>三次握手<ul>
<li>三次握手是为了确认客户端和服务端的收发能力是否都正常</li>
<li>第一次，服务端知道客户端发能力和自己接收能力正常</li>
<li>第二次，客户端知道服务端发送能力正常，自己的接收能力正常</li>
<li>第三次，知道所有功能正常</li>
</ul>
</li>
<li>慢启动</li>
</ul>
<p>HTTP3的草案是基于QUIC协议，它基于UDP，它热启动，增加了TSL1.3的加密，解决了安全问题</p>
<h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>https是什么，就是基于TSL/SSL的通信协议</p>
<p>基于CA证书的公钥私钥进行非对称加密，互相交换对称密钥</p>
<p>其他部分也是基于TCP的三次握手之类的还是避免不了，它只是交换密钥，对内容进行加密传输</p>
<p>交换密钥的过程：</p>
<ul>
<li>客户端给服务端发送请求，包含一个随机数，客户端支持的机密算法，协议版本号https</li>
<li>服务端返回CA证书（公钥就在CA证书中，只要颁发CA证书的机构是可信任的，这个密钥就是可信任的）、双方支持的加密算法、以及客户端的随机数</li>
<li>前两个随机数是明文的，最后拿到ca证书的公钥加密一个新的随机数发送给服务端</li>
<li>当前客户端服务端都确认了加密算法，三个随机数。</li>
<li>之后的通信内容就都根据三个随机数和加密算法加密内容传输</li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/10/21/browser-1/">浏览器：浏览器缓存机制</a></h1>
  

      
        <time datetime="2020-10-21T08:08:09.000Z">2020-10-21</time>
      
    </header>
    <div class="entry">
      
        <h2 id="浏览器缓存策略"><a href="#浏览器缓存策略" class="headerlink" title="浏览器缓存策略"></a>浏览器缓存策略</h2><ul>
<li>强制缓存<ul>
<li>强制缓存返回的状态码也是200，只不过会标记出from memory cache 或者 from disk cache</li>
<li>匹配了强制缓存的情况下，不需要向服务器发送请求来验证，可以直接从缓存读取数据</li>
</ul>
</li>
<li>协商缓存<ul>
<li>协商缓存是请求了一遍服务器，如果内容没有变，则会返回状态码304（not modified）否则返回状态码200，相当于重新请求</li>
</ul>
</li>
</ul>
<h2 id="强制缓存"><a href="#强制缓存" class="headerlink" title="强制缓存"></a>强制缓存</h2><ul>
<li>cache-control<ul>
<li>public 路由器啥的都能缓存</li>
<li>private 只能浏览器缓存</li>
<li>no-cache 客户端缓存，但是得走协商缓存</li>
<li>no-store 不缓存</li>
<li>max-age=xxx 缓存在xxx之间后失效</li>
</ul>
</li>
<li>expires(到期时间)<ul>
<li>服务器返回数据给的缓存到期时间，但是不准确，毕竟客户端和服务端时间本来就不一样</li>
<li>http1.1之后就cache-control的权重就比它大了</li>
</ul>
</li>
</ul>
<p><strong>怎么击中协商缓存？</strong></p>
<p>cache-control非no-cache|no-store，&amp; （max-age倒计时没到 ｜ expires没到时）<br>如果击中了强制缓存，浏览器直接使用缓存数据:</p>
<ul>
<li><p>缓存数据是js或者图片数据，http请求返回状态码200，标示from memory cache</p>
</li>
<li><p>缓存数据是css文件，http请求返回状态码200，标示from disk cache</p>
</li>
</ul>
<p>原因是：浏览器会吧js或者图片文件缓存到内存中，css文件缓存到硬盘中，所以浏览器重绘的代价也比较大</p>
<h2 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h2><ol>
<li><p>强制缓存缓存没有命中，会走协商缓存</p>
</li>
<li><p>cache-control：no-cache 直接走协商缓存</p>
</li>
</ol>
<p>客户端带的协商缓存请求头</p>
<ul>
<li>if-modified-since，如果没有击中强缓存，这个字段会带着服务端请求带回来的Last-Modified值</li>
<li>if-none-matched，如果没有击中强缓存，客户端请求会带着这个请求头字段，值为服务端返回的Etag值</li>
</ul>
<p>服务端返回的缓存标示请求头</p>
<ul>
<li><p>Etag 标示符， 服务端对内容，文件索引，大小，最后修改时间得来的哈希值，服务端返回数据的请求头带的</p>
</li>
<li><p>Last-Modified：服务端发送给客户端的资源最后修改时间</p>
</li>
<li><p>缓存没有变化， http请求服务器返回状态码304</p>
</li>
<li><p>缓存有变化，http请求返回200，相当于重新请求</p>
</li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/09/07/vue-1/">vue-1</a></h1>
  

      
        <time datetime="2020-09-07T15:05:38.000Z">2020-09-07</time>
      
    </header>
    <div class="entry">
      
        
      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/09/07/css-1/">层叠上下文（内附浏览器渲染流程）</a></h1>
  

      
        <time datetime="2020-09-07T13:14:41.000Z">2020-09-07</time>
      
    </header>
    <div class="entry">
      
        <h2 id="什么地方的概念-—-浏览器渲染流程"><a href="#什么地方的概念-—-浏览器渲染流程" class="headerlink" title="什么地方的概念 — 浏览器渲染流程"></a>什么地方的概念 — 浏览器渲染流程</h2><p>首先我们需要知道浏览器渲染一个页面的时：</p>
<ul>
<li><strong>生成DOM树</strong>。<ul>
<li>html是超文本标记语言，它是一个文件，代码片段，需要被浏览器html解释器解释成DOM树</li>
<li>即document这个对象，他的结构和html是一样的，但是它存储在内存中，可以被js操作</li>
</ul>
</li>
<li><strong>生成CSS层叠样式表</strong>。<ul>
<li>根据“继承”“层叠（我理解就是权重比较选择，这里的层叠意义和即将要讲的不一样）”，生成每个元素的最终Computed的属性值。</li>
<li>document.stylesheets可以打印查看</li>
</ul>
</li>
<li><strong>生成布局树</strong>。<ul>
<li>DOM树和CSS层叠样式表合起来并不能开始渲染，还得生成布局树。</li>
<li>布局树，根据DOM树和CSS树生成。<ul>
<li>它舍去了DOM树中不需要渲染的节点（head，script标签内容）</li>
<li>去除不需要渲染的DOM节点（display:none）。</li>
</ul>
</li>
<li>然后根据DOM树和CSS层叠样式表生成</li>
</ul>
</li>
<li><strong>生成图层</strong><ul>
<li>它就是这次要讲的内容</li>
<li>通过浏览器的Chrome的layer工具可以查看浏览器渲染内容的层级结构</li>
<li>并不是每个Dom节点都会生成一层图层，没有单独图层的Dom节点图层和父节点一致</li>
<li>什么样的Dom节点会生成单独的图层呢？<ul>
<li>拥有<strong>层叠上下文属性</strong>的Dom节点会生成一个图层</li>
<li>需要被裁剪的Dom会生成一个图层，overflow: auto; 超出的内容不显示，需要裁剪出来显示的部分，这时候显示的部分就会产生一个图层</li>
</ul>
</li>
</ul>
</li>
<li><strong>根据图层，生成绘制指令列表</strong><ul>
<li>首先，计算机怎么绘制这个图层呢，需要一个个指令，比如先在什么位置画一个矩形，填充什么颜色，很想事canvas的画图，一条条指令。</li>
<li>这个指令合集生成之后，并不会立即进行绘制</li>
<li>交给了渲染进程的合成线程去操作</li>
</ul>
</li>
<li><strong>栅格化</strong><ul>
<li>合成线程首先会把图层分为一个个的图块。</li>
<li>然后<strong>栅格化</strong>，什么是栅格化（<strong>其实就是生成位图，甚至可以叫它位图化</strong>）</li>
<li>栅格化的过程是会根据是否靠近视窗口的优先级进行</li>
<li>栅格化是渲染进程维护了一个线程池专门进行的，因为比较耗时，现代浏览器都会开启<strong>GPU加速，生成的位图缓存在GPU内存中</strong></li>
</ul>
</li>
<li><strong>合成和显示</strong><ul>
<li>一旦栅格化之后，就是产生了位图之后，会提交给合成线程一个命令</li>
<li>这个命令把位图放在内存中，然后显示到屏幕上</li>
</ul>
</li>
</ul>
<p>以上，就是浏览器渲染的整个流程了</p>
<h2 id="层叠上下文"><a href="#层叠上下文" class="headerlink" title="层叠上下文"></a>层叠上下文</h2><p>上面浏览器渲染的过程中，其他的概念都比较好理解，就是其中生成图层的时候的<strong>拥有层叠上下文的dom，到底是个什么东西？</strong></p>
<p>和<a href="http://triumphlic.xyz/2020/07/03/base-0/">块级格式化上下文（BFC）</a>一样，它是一个概念，比较抽象，不太好理解。</p>
<p>首先谈谈我没有深入了解这部分知识之前的理解：</p>
<ul>
<li>觉得z-index就是层级的唯一控制字段</li>
<li>不知道什么是层叠上下文元素</li>
<li>不知道什么是层叠水平</li>
<li>没听说过层叠顺序</li>
</ul>
<h2 id="概念理解"><a href="#概念理解" class="headerlink" title="概念理解"></a>概念理解</h2><ul>
<li><p>什么是层叠上下文元素</p>
<ul>
<li><p>首先一个树型dom</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dom = &#123;</span><br><span class="line">  x: &#123;</span><br><span class="line">      z-index: <span class="number">2</span>,</span><br><span class="line">      a: &#123; z-index: <span class="number">2</span> &#125;,</span><br><span class="line">      b: &#123; z-index: <span class="number">3</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  y: &#123;</span><br><span class="line">    z-index: <span class="number">1</span>,</span><br><span class="line">    c: &#123; z-index: <span class="number">100</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果x,y是层叠上下文元素，上面这个dom最终渲染的图层b,a在c的上面</p>
</li>
<li><p>所以，可以这么理解，层叠上下文元素，是内部的层叠水平和外界没有关系的dom元素，内部元素的层叠水平是根据当前所在的层叠上下文元素的基础上计算的</p>
</li>
</ul>
</li>
<li><p>层叠水平</p>
<pre><code>其实就是层级的高低，根据上面的解释，可以理解为：层叠水平是基于当前所在的层叠上下文元素的</code></pre></li>
<li><p>层叠的规则</p>
<ul>
<li>同一个层叠上下文内，根据z-index大小决定层级水平</li>
<li>相同的z-index层级是覆盖逻辑</li>
</ul>
</li>
</ul>
<h2 id="怎么产生层级上下文"><a href="#怎么产生层级上下文" class="headerlink" title="怎么产生层级上下文"></a>怎么产生层级上下文</h2><ul>
<li>根元素，和根元素是BFC一样，跟元素也是一个层级上下文元素</li>
<li>给定position除了static值，并且设置了z-index属性的元素</li>
<li>css3的一些属性也会产生层级上下文<ul>
<li>父节点是flex布局，所有z-index不是auto的自元素都是层级上下文元素</li>
<li>透明度不是1的元素opacity !== 1</li>
<li>transform属性</li>
<li>mix-blend-mode（这个属性表示当前元素和父元素背景怎么融合显示，比如三元素合成白色之类的）</li>
<li>filter不为空 （<strong>根元素</strong>增加filter: grayscale(100%);秒变黑白屏）</li>
<li>will-change以上的属性 关于<a href="https://www.zhangxinxu.com/wordpress/2015/11/css3-will-change-improve-paint/" target="_blank" rel="noopener">will-change</a>的文章，可以适当的使用开启GPU加速</li>
</ul>
</li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/08/25/service-0/">CentOS8搭建nexus</a></h1>
  

      
        <time datetime="2020-08-25T07:38:09.000Z">2020-08-25</time>
      
    </header>
    <div class="entry">
      
        <h2 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h2><p>  linux系统发行版之一，买服务器的时候综合很多意见，统一被推荐这个系统</p>
<h2 id="云服务"><a href="#云服务" class="headerlink" title="云服务"></a>云服务</h2><p>  买了阿里云的云服务，创建服务跟着教程走就行，选择centos8系统</p>
<h2 id="mac的相关配置"><a href="#mac的相关配置" class="headerlink" title="mac的相关配置"></a>mac的相关配置</h2><ul>
<li><p>首先需要一个iterm2</p>
</li>
<li><p>给iterm2下载一个lrzsz的插件用来给服务器上传文件</p>
</li>
<li><p>使用lrzsz上传包时候一定要等待完，别猴急不然上传一半也是可以解压的，完了后续操作也是白搭（血泪史）</p>
</li>
</ul>
<h2 id="java的jre、jdk安装"><a href="#java的jre、jdk安装" class="headerlink" title="java的jre、jdk安装"></a>java的jre、jdk安装</h2><p>  我用的是centos自带的yum安装的（尽量不要使用这个方式，不可控不清楚具体文件位置，环境变量改写位置）</p>
<h2 id="安装maven"><a href="#安装maven" class="headerlink" title="安装maven"></a>安装maven</h2><ul>
<li>下载安装包</li>
<li>上传到服务器</li>
<li>当前用户目录下执行<strong>tar -zxvf apache-maven-3.5.4-bin.tar.gz</strong>解压文件</li>
<li><strong>mv apache-maven-3.5.4 /usr/local</strong> 移动到local文件夹内</li>
<li>vim /etc/profile 尾部添加<pre><code>MAVEN_HOME=/usr/local/apache-maven-3.5.4
export MAVEN_HOME</code></pre></li>
<li>mvn -v查看maven版本信息</li>
<li>完成</li>
</ul>
<h2 id="安装Nexus"><a href="#安装Nexus" class="headerlink" title="安装Nexus"></a>安装Nexus</h2><ul>
<li>下载安装包（我在官网下的）</li>
<li>tar -zxvf nexus-3.13.0-01-unix.tar.gz</li>
<li>mv nexus-3.13.0-01 /usr/local</li>
<li>cd /usr/local/nexus-3.13.0-01/bin</li>
<li>./nexus start</li>
<li>服务器的nexus服务就起来了，默认跑在了8081端口上</li>
</ul>
<h2 id="开放服务器相应端口"><a href="#开放服务器相应端口" class="headerlink" title="开放服务器相应端口"></a>开放服务器相应端口</h2><p>我买的是阿里云的CentOS服务</p>
<ul>
<li>控制台侧边栏找到网络与安全/安全组</li>
<li>创建安全组</li>
<li>开放8081端口</li>
</ul>
<h2 id="访问自己的nexus服务"><a href="#访问自己的nexus服务" class="headerlink" title="访问自己的nexus服务"></a>访问自己的nexus服务</h2><p>阿里元IP地址+端口号访问</p>
<ul>
<li>增加除了admin之外的账号，邮箱+密码//这个也用来上传包（npm login登录用）</li>
<li>创建仓库npm（proxy，hosted，group）</li>
<li>本机nrm add 一个新的仓库，使用group的地址</li>
<li>npm login 登录</li>
<li>上传</li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/07/08/js-base-5/">js基础:this指向call、apply、bind</a></h1>
  

      
        <time datetime="2020-07-08T11:08:58.000Z">2020-07-08</time>
      
    </header>
    <div class="entry">
      
        <h2 id="this"><a href="#this" class="headerlink" title="this"></a>this</h2><p>this原理<a href="https://www.ruanyifeng.com/blog/2018/06/javascript-this.html" target="_blank">阮一峰博客</a>讲的很好了</p>
<p>this是js里面很特殊的一个东西，整个js是词法作用域的（静态），但是this的指向确实动态的</p>
<p>this指向当前执行上下文环境，运行时环境。</p>
<h2 id="this的指向整理"><a href="#this的指向整理" class="headerlink" title="this的指向整理"></a>this的指向整理</h2><p><a href="https://www.ruanyifeng.com/blog/2018/06/javascript-this.html" target="_blank">MDN地址</a></p>
<ol>
<li><h2 id="全局环境中"><a href="#全局环境中" class="headerlink" title="全局环境中"></a>全局环境中</h2><p> 无论是否是严格模式，this都指向全局对象window、global</p>
</li>
<li><h2 id="函数执行环境中（运行时）"><a href="#函数执行环境中（运行时）" class="headerlink" title="函数执行环境中（运行时）"></a>函数执行环境中（运行时）</h2></li>
</ol>
<ul>
<li>正常调用<br>  函数内是严格模式，this指向undefined，非严格模式下指向全局对象</li>
</ul>
<h2 id="call"><a href="#call" class="headerlink" title="call"></a>call</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">c, d , e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.a + <span class="keyword">this</span>.b + c + d + e </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line">sum.call(obj, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>

<p>call 用来改变函数运行时this的指向</p>
<p>传参格式是 fun.call(obj, arg0, arg1…)</p>
<h2 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上面的函数也可以这样调用</span></span><br><span class="line">sum.apply(obj, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]) <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>

<p>apply的行为是和call一致的，传参的方式不一致。<br>传参方式是fun.apply(obj, [arg1, arg2, …])</p>
<h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>bind的行为方式和call、apply是不一致的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同样的期望，bind的方式是这样的</span></span><br><span class="line">sum.bind(obj)(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>

<p>可以看到，bind操作会产生一个新的函数，这个函数的this被绑定到了指定的对象上了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> newSum = sum.bind(obj)</span><br><span class="line">newSum(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>call、apply会执行函数，这一次调用的this被替换了，再次正常调用原函数，this还是原来的指向<br>bind会返回一个改变了this的新函数，新函数的this被改变成了指定的对象</p>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->




  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2020/07/06/js-base-4/">js基础--js执行机制</a></h1>
  

      
        <time datetime="2020-07-06T13:01:10.000Z">2020-07-06</time>
      
    </header>
    <div class="entry">
      
        <h2 id="js执行机制"><a href="#js执行机制" class="headerlink" title="js执行机制"></a>js执行机制</h2><p>首先，<em>js是单线程的</em>，它从诞生就是单线程的。</p>
<p>为什么不能是多线程？浏览器两个线程同时操作Dom，就没得玩了</p>
<p>tip： html5的web worker标准，允许js脚本创建多个线程，但是完全被主线程控制，且不能操作Dom</p>
<h2 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h2><p>  js的运行环境一定不是单线程的。</p>
<p>  浏览器中，常驻线程就三个： js执行主线程，GUI渲染线程，事件监听线程。<br>  还有http请求线程，定时器线程</p>
<p>  Dom渲染时，js线程会被挂起。</p>
<h2 id="线程和进程"><a href="#线程和进程" class="headerlink" title="线程和进程"></a>线程和进程</h2><p>  进程是CPU分配资源的最小单位，线程是资源执行的最小单位。</p>
<p>  一个进程没有线程就不能执行，那就只是静止的资源。</p>
<p>  进程中可以存在很多线程，线程的通行可以通过资源内存共享比较方便。进程之间通行就得通过管道、消息来通信了。</p>
<p>  打开浏览器会启动这几个<strong>进程</strong></p>
<ul>
<li><p>browser进程，控制与用户交互，前进后退，渲染等行为</p>
</li>
<li><p>GPU进程，控制3D渲染，如果没有开启硬件加速，则使用browser进程渲染</p>
</li>
<li><p>插件进程，以保证插件崩了网页不崩</p>
<p>那么js运行在哪呢？render进程</p>
<p>每次打开一个Tab标签页面，对应的浏览器都会启动一个新的<strong>Render进程</strong><br><em>但是相同的站点，只有一个进程</em>，相同的协议，相同的根域名</p>
<p>这个render进程里，有很多线程。</p>
<p>三个常驻线程：</p>
<ul>
<li>js执行主进程</li>
<li>GUI渲染进程，页面渲染，重绘，回流都得触发它，执行时主线程挂起</li>
<li>事件监听触发线程<br>还有</li>
<li>http请求线程</li>
<li>定时器线程</li>
</ul>
</li>
</ul>
<h2 id="任务队列"><a href="#任务队列" class="headerlink" title="任务队列"></a>任务队列</h2><p>  单线程意味着，一个时间，js只能做一件事，做一个任务。</p>
<p>  那么，js执行就得排队</p>
<p>  如果，所有的任务都一件一件顺序执行，那么有一些Ajax请求很耗时，不能等到它执行完再走下一个任务。</p>
<h4 id="所以，js的任务分成了两种，同步任务-amp-异步任务"><a href="#所以，js的任务分成了两种，同步任务-amp-异步任务" class="headerlink" title="所以，js的任务分成了两种，同步任务 &amp; 异步任务"></a>所以，js的任务分成了两种，同步任务 &amp; 异步任务</h4><ul>
<li><p>同步任务： 在主线程上执行，只有上一个任务完成了，才会执行下一个任务，形成了一个执行栈</p>
</li>
<li><p>异步任务： 不进入主进程执行，被推入<strong>异步队列</strong>（task queue），只有任务队列通知主线程某个任务需要执行了，才会进入主线程执行</p>
<h4 id="所以js的异步执行模式就是这样的"><a href="#所以js的异步执行模式就是这样的" class="headerlink" title="所以js的异步执行模式就是这样的"></a>所以js的异步执行模式就是这样的</h4><ul>
<li>同步任务，生成执行栈，一个一个顺序执行</li>
<li>异步任务被挂起，推到<strong>异步队列</strong>，等待执行</li>
<li>执行栈所有内容执行完，主线程读取“异步队列”的需要执行的任务，推到执行栈中执行</li>
<li>重复上面三步</li>
</ul>
</li>
</ul>
<h2 id="事件和回调函数"><a href="#事件和回调函数" class="headerlink" title="事件和回调函数"></a>事件和回调函数</h2><p>  <strong>异步任务队列</strong>，是一个<strong>事件的队列</strong>，无论是IO设备触发的事件，还是ajax事件，都是事件。</p>
<p>  每个事件都需要设置一个<strong>回调函数</strong>，它会被用来推到执行栈执行</p>
<p>  这些事件一触发，就相当于给“异步队列”通知说： ”我的回调函数可以被推到执行栈执行了！“</p>
<p>  只要主线程的执行栈一清空，任务队列第一个事件的回调函数就被推到主线程的执行栈执行了</p>
<h2 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h2><p>  上面介绍的</p>
<pre><code>主线程的执行栈清空、执行完之后，需要从异步任务队列中读取任务，这个过程是循环的：所以叫事件循环Event Loop</code></pre><p>  主线程运行的时候，产生堆（存放数据）栈（执行js任务）</p>
<p>  执行栈任务执行的同时，会调用一些IO的API，Ajax的API去产生新的异步任务，并且添加到异步任务队列中</p>
<p>  某一时刻执行栈中的代码，一定在异步任务队列执行前执行</p>
<h2 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h2><p>  setTimeout() &amp;&amp; setInterval()</p>
<p>  setTimeout(fn,0)的含义是，指定某个任务在主线程最早可得的空闲时间执行，也就是说，尽可能早得执行。它在”任务队列”的尾部添加一个事件，因此要等到同步任务和”任务队列”现有的事件都处理完，才会得到执行。</p>
<p>  队列： 队首添加，队尾删除。</p>
<p>  setTimeout(fn, 1000) ，会进入定时器线程进行倒计时，时间到了在主线程异步宏任务队列添加回调函数，等待主线程执行栈清空，主线程去任务队列取任务放在执行栈执行。</p>
<p>  如果主线程执行栈有任务正在执行，那势必会影响到定时器的准确性。</p>
<h2 id="宏任务、微任务"><a href="#宏任务、微任务" class="headerlink" title="宏任务、微任务"></a>宏任务、微任务</h2><p>  在浏览器环境里，宏任务微任务可以大致的分为，需要调用其他线程的API都是宏任务，js主线程产生的异步任务属于微任务。</p>
<p>  <strong>每个宏任务都关联了一个微任务队列</strong></p>
<p>  V8引擎在进入一个宏任务执行时，都会给这个宏任务生成一个微任务队列用于存放微任务。</p>
<p>  宏任务：</p>
<ul>
<li><p>setTimeout/setInterval</p>
</li>
<li><p>IO操作</p>
</li>
<li><p>http请求</p>
</li>
<li><p>script脚本执行</p>
</li>
<li><p>Dom渲染</p>
<p>微任务：</p>
</li>
<li><p>Promise</p>
</li>
<li><p>MutationObserver</p>
</li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>

<!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 21:27:37
 * @Description  : 描述信息
 -->





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <!--
 * @Author       : licheng252@xdf.cn
 * @Date         : 2020-04-21 16:01:24
 * @LastEditors  : licheng252@xdf.cn
 * @LastEditTime : 2020-05-11 20:48:26
 * @Description  : 描述信息
 -->

<div class="widget tag">
  <h3 class="title">目录</h3>
  <ul class="entry">
    
      <li>
        <a href="/2020/11/18/js-base-7/">手写promise</a>
      </li>
    
      <li>
        <a href="/2020/10/28/browser-3/">WebWorkers</a>
      </li>
    
      <li>
        <a href="/2020/10/22/js-base-6/">手写Promise.all-limit</a>
      </li>
    
      <li>
        <a href="/2020/10/21/browser-2/">http</a>
      </li>
    
      <li>
        <a href="/2020/10/21/browser-1/">浏览器：浏览器缓存机制</a>
      </li>
    
      <li>
        <a href="/2020/09/07/vue-1/">vue-1</a>
      </li>
    
      <li>
        <a href="/2020/09/07/css-1/">层叠上下文（内附浏览器渲染流程）</a>
      </li>
    
      <li>
        <a href="/2020/08/25/service-0/">CentOS8搭建nexus</a>
      </li>
    
      <li>
        <a href="/2020/07/08/js-base-5/">js基础:this指向call、apply、bind</a>
      </li>
    
      <li>
        <a href="/2020/07/06/js-base-4/">js基础--js执行机制</a>
      </li>
    
      <li>
        <a href="/2020/07/06/base-4/">js:x=y=0;a.x=a={n:1}</a>
      </li>
    
      <li>
        <a href="/2020/07/05/base-3/">css:两栏、三栏、圣杯、双飞翼布局</a>
      </li>
    
      <li>
        <a href="/2020/07/05/base-2/">css:盒模型，box-sizing应用场景</a>
      </li>
    
      <li>
        <a href="/2020/07/03/base-1/">css:box-shadow</a>
      </li>
    
      <li>
        <a href="/2020/07/03/base-0/">css:BFC</a>
      </li>
    
      <li>
        <a href="/2020/07/02/webpack-2/">webpack:文件处理</a>
      </li>
    
      <li>
        <a href="/2020/07/01/webpack-1/">webpack:MiniCssExtractPlugin问题</a>
      </li>
    
      <li>
        <a href="/2020/06/22/vue-0-md/">vue的基本概览.md</a>
      </li>
    
      <li>
        <a href="/2020/05/21/nginx/">nginx操作</a>
      </li>
    
      <li>
        <a href="/2020/05/06/js-base-3/">js基础 -- 执行上下文，变量环境，词法环境，作用域相关</a>
      </li>
    
      <li>
        <a href="/2020/05/04/webpack-0/">webpack:基础知识</a>
      </li>
    
      <li>
        <a href="/2020/05/02/js-base-2/">js基础 --原型相关方法，Object，Reflect</a>
      </li>
    
      <li>
        <a href="/2020/04/30/js-base-1/">js基础 --类和继承</a>
      </li>
    
      <li>
        <a href="/2020/04/25/js-base-0/">js基础 --原型链</a>
      </li>
    
      <li>
        <a href="/2020/04/23/functional-2/">函数式编程 --组合和管道</a>
      </li>
    
      <li>
        <a href="/2020/04/22/functional-1/">函数式编程 --函数的柯里化</a>
      </li>
    
      <li>
        <a href="/2020/04/21/functional-0/">函数式编程 --纯函数</a>
      </li>
    
      <li>
        <a href="/2020/04/21/wasm-2/">WASM（二）</a>
      </li>
    
      <li>
        <a href="/2020/03/21/wasm-1/">WASM（一）</a>
      </li>
    
  </ul>
</div>


  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2020 triumphLic
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



</body>
</html>

